<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="generator" content="Bootply" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Marten - Bulk Insert</title>
    <link href="/v3/content/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="/v3/content/prism.css" rel="stylesheet" type="text/css" />
    <link href="/v3/content/theme.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" />

    <link rel="apple-touch-icon" href="/bootstrap/img/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/bootstrap/img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/bootstrap/img/apple-touch-icon-114x114.png">

    <!-- CSS code from Bootply.com editor -->
    <link href="/v3/content/affix.css" rel="stylesheet" type="text/css" />
</head>

<!-- HTML code from Bootply.com editor -->

<body>
    <a href="https://github.com/jasperfx/marten"><img style="z-index: 5000; position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>

    <nav class="navbar navbar-default navbar-fixed-top" role="banner">
        <div class="container">
            <div class="navbar-header">
                <a href="/marten" class="navbar-brand">Marten 3.13.1</a>
            </div>
            <nav class="collapse navbar-collapse" role="navigation">
                <ul class="nav navbar-nav pull-right">
                    <li>
                        <a href="/v3/getting_started">Getting Started</a>
                    </li>
                    <li>
                        <a href="/v3/documentation">Documentation</a>
                    </li>
                    <li>
                        <a href="/v3/migration_guide">Migration Guide</a>
                    </li>
                    <li>
                        <a href="https://gitter.im/jasperfx/marten?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/jasperfx/marten" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a>
                    </li>
                    <li>
                        <a href="https://twitter.com/marten_lib?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @marten_lib</a>
                        <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                    </li>
                    <li><a href="/v3/documentation/documents/basics/deleting" title="Deleting Documents">Previous</a></li>
                <li><a href="/v3/documentation/documents/basics/initial_data" title="Initial Data">Next</a></li>
                </ul>
                <div class="navbar-form navbar-left" role="search">
                    <div class="form-group">
                        <input id="search" type="search" class="form-control" placeholder="Search">
                    </div>
                </div>
            </nav>
        </div>
    </nav>
    <div class="container">
        <nav class="navbar-inverse">
            <ol class="breadcrumb"><li><a href="/v3/">Marten</a></li><li><a href="/v3/documentation">Documentation</a></li><li><a href="/v3/documentation/documents">Marten as Document Db</a></li><li><a href="/v3/documentation/documents/basics">Document Basics</a></li><li class="active">Bulk Insert</li></ol>
        </nav>
    </div>
    <!--main-->
    <div class="container">
        <div class="row">
            <!--left-->

            <div class="col-md-3" id="leftCol">

                <img src="/content/images/emblem.png" width="80%" align="middle" />
                <br />
                <ul class="nav nav-stacked affix" id="sidebar"></ul>
                <h3 class="no-margin">Next</h3><p><a href="/v3/documentation/documents/basics/initial_data">Initial Data</a></p>
                    <h3 class="no-margin">Previous</h3><a href="/v3/documentation/documents/basics/deleting">Deleting Documents</a></p>
                </ul>
            </div><!--/left-->
            <!--right-->
            <div class="col-md-9">
                <h1>Bulk Insert <a href="https://github.com/jasperfx/marten/blob/3.13/documentation/documentation/documents/basics/bulk_insert.md" class="text-muted small pull-right fa fa-github" style="margin-top: 10px"> Edit on GitHub</a></h1>

                <hr />
                <div id="main-pane">
                    <!--Title:Bulk Insert-->
<!--Url:bulk_insert-->
<p>Marten supports <a href="http://www.postgresql.org/docs/9.4/static/sql-copy.html">Postgresql's COPY</a> functionality for very efficient insertion of documents like you might need for test data set up or data migrations. Marten calls this feature &quot;Bulk Insert,&quot; and it's exposed off the <code>IDocumentStore</code> interface as shown below:</p>
<pre><code class="language-csharp">&#xD;&#xA;// This is just creating some randomized&#xD;&#xA;// document data&#xD;&#xA;var data = Target.GenerateRandomData(100).ToArray();&#xD;&#xA;&#xD;&#xA;// Load all of these into a Marten-ized database&#xD;&#xA;theStore.BulkInsert(data, batchSize: 500);&#xD;&#xA;&#xD;&#xA;// And just checking that the data is actually there;)&#xD;&#xA;theSession.Query&lt;Target&gt;().Count().ShouldBe(data.Length);&#xD;&#xA;</code></pre>
<p>The bulk insert is done with a single transaction. For really large document collections, you may need to page the calls to <code>IDocumentStore.BulkInsert()</code>.</p>
<p><strong>By default, bulk insert will fail if there are any duplicate id's between the documents being inserted and the existing database data.</strong></p>
<p>If you want to use the bulk insert feature, but you know that you could have duplicate documents, you can use one of the two following optional modes:</p>
<h2 id="ignore-duplicate-values">Ignore Duplicate Values</h2>
<p>In this case, you only want to insert brand new documents and just throwaway any potential changes to existing documents.</p>
<pre><code class="language-csharp">&#xD;&#xA;var data = Target.GenerateRandomData(100).ToArray();&#xD;&#xA;&#xD;&#xA;theStore.BulkInsert(data, BulkInsertMode.IgnoreDuplicates);&#xD;&#xA;</code></pre>
<p>Internally, Marten creates a temporary table matching the targeted document table and inserts the new values into that table. After writing those documents, Marten issues
an INSERT command to copy rows from the temporary table to the real table, filtering out any matches in existing id's.</p>
<h2 id="overwrite-duplicates">Overwrite Duplicates</h2>
<p>In the second case, you want to use the bulk insert to write a batch of documents and overwrite any existing data with matching id's:</p>
<pre><code class="language-csharp">&#xD;&#xA;var data = Target.GenerateRandomData(100).ToArray();&#xD;&#xA;&#xD;&#xA;theStore.BulkInsert(data, BulkInsertMode.OverwriteExisting);&#xD;&#xA;</code></pre>
<p>Internally, Marten creates a temporary table matching the targeted document table and inserts the new values into that table. After writing those documents, Marten issues
an INSERT command to copy rows from the temporary table to the real table, filtering out any matches in existing id's, then a second UPDATE command to overwrite data from
the matching id's.</p>

                </div>
                <hr />
                <nav class="related-links">
                    <span>
                        <strong>Previous: </strong><a href="/v3/documentation/documents/basics/deleting">Deleting Documents</a>
                    </span>
                    <span class="pull-right">
                        <strong>Next: </strong><a href="/v3/documentation/documents/basics/initial_data">Initial Data</a>
                    </span>
                </nav>
            </div><!--/right-->
        </div><!--/row-->
    </div><!--/container-->
    <footer>
        <ul>
            <li>
                <a href="https://dotnetfoundation.org">
                    <img class="dot-net-foundation-logo" src="https://raw.githubusercontent.com/dotnet/swag/master/logo/dotnetfoundation_v4.png" alt="Supported by the .NET Foundation" />
                </a>
                Supported by the <a href="https://dotnetfoundation.org">.NET Foundation</a>
            </li>
        </ul>
    </footer>
</body>

<foot>
    <script type='text/javascript' src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type='text/javascript' src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/v3/content/prism.js"></script>
    <script type="text/javascript" src="/v3/content/sidebar.js"></script>
    <script type="text/javascript" src="/v3/content/affix.js"></script>

    <script>
        $('#search').keyup(function (e) {
            if (e.keyCode == 13) {
                var search = $('#search').val();

                var url = 'https://www.google.com/#q=site:jasperfx.github.io ' + search;
                url = encodeURI(url);

                //alert(url);

                window.location.href = url;

                e.stopPropagation();
                if (e.cancelBubble != null) e.cancelBubble = true;
                return false;
            }

        });
    </script>
</foot>
</html>
